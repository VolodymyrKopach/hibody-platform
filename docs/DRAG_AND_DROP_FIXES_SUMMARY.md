# Drag & Drop - –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ë–∞–≥—ñ–≤

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–ö–æ–ª–∏ –≤–∏ –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–ª–∏ –µ–ª–µ–º–µ–Ω—Ç–∏ (–≤ –º–µ–∂–∞—Ö –æ–¥–Ω—ñ—î—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –∞–±–æ –º—ñ–∂ —Å—Ç–æ—Ä—ñ–Ω–∫–∞–º–∏), –≤—ñ–∑—É–∞–ª—å–Ω—ñ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä–∏ –ø—Ä–∞—Ü—é–≤–∞–ª–∏ –∫–æ—Ä–µ–∫—Ç–Ω–æ, –∞–ª–µ —Å–∞–º –µ–ª–µ–º–µ–Ω—Ç –ù–ï –º—ñ–Ω—è–≤ —Å–≤–æ—î—ó –ø–æ–∑–∏—Ü—ñ—ó –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è drag & drop –æ–ø–µ—Ä–∞—Ü—ñ—ó.

## üîç –ó–Ω–∞–π–¥–µ–Ω—ñ –ë–∞–≥–∏

### –ë–∞–≥ #1: Event Handlers –ù–µ –í–∏–∫–ª–∏–∫–∞–ª–∏ preventDefault()

**–ö–æ–¥ (–±—É–ª–æ):**
```typescript
onDragOver={(e) => !element.locked && handleElementDragOver(e, realIndex)}
onDrop={(e) => !element.locked && handleElementDrop(e, realIndex)}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –Ø–∫—â–æ `element.locked === true`, —Ñ—É–Ω–∫—Ü—ñ—è –ø–æ–≤–µ—Ä—Ç–∞–ª–∞ `false` –ë–ï–ó –≤–∏–∫–ª–∏–∫—É `e.preventDefault()`
- –ë—Ä–∞—É–∑–µ—Ä –≤—ñ–¥—Ö–∏–ª—è–≤ drop target, —Ç–æ–º—É —â–æ –Ω–µ –±—É–ª–æ –≤–∏–∫–ª–∏–∫–∞–Ω–æ `preventDefault()` –≤ `onDragOver`
- Drop event –≤–∑–∞–≥–∞–ª—ñ –Ω–µ —Å–ø—Ä–∞—Ü—å–æ–≤—É–≤–∞–≤

### –ë–∞–≥ #2: Drop Indicators –ë–ª–æ–∫—É–≤–∞–ª–∏ Mouse Events

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –°–∏–Ω—è/–∑–µ–ª–µ–Ω–∞ –ª—ñ–Ω—ñ—è (drop indicator) –±—É–ª–∞ –∑–≤–∏—á–∞–π–Ω–∏–º DOM –µ–ª–µ–º–µ–Ω—Ç–æ–º
- –ö–æ–ª–∏ –≤–∏ –≤—ñ–¥–ø—É—Å–∫–∞–ª–∏ –º–∏—à–∫—É "–Ω–∞ —Å–∏–Ω—ñ–π –ª—ñ–Ω—ñ—ó", –ø–æ–¥—ñ—ó –π—à–ª–∏ –Ω–∞ indicator, –∞ –Ω–µ –Ω–∞ –µ–ª–µ–º–µ–Ω—Ç –ø—ñ–¥ –Ω–∏–º
- Indicator –Ω–µ –º–∞–≤ drop handlers, —Ç–æ–º—É drop –Ω–µ —Å–ø—Ä–∞—Ü—å–æ–≤—É–≤–∞–≤

## ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

### –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è #1: –ó–∞–≤–∂–¥–∏ –í–∏–∫–ª–∏–∫–∞—Ç–∏ preventDefault()

**–ö–æ–¥ (—Å—Ç–∞–ª–æ):**
```typescript
onDragOver={(e) => {
  e.preventDefault(); // –ó–ê–í–ñ–î–ò –≤–∏–∫–ª–∏–∫–∞—î–º–æ, –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —É–º–æ–≤
  if (!element.locked) {
    handleElementDragOver(e, realIndex);
  }
}}
onDrop={(e) => {
  e.preventDefault(); // –ó–ê–í–ñ–î–ò –≤–∏–∫–ª–∏–∫–∞—î–º–æ, –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —É–º–æ–≤
  if (!element.locked) {
    handleElementDrop(e, realIndex);
  }
}}
```

### –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è #2: –ó—Ä–æ–±–∏—Ç–∏ Indicators –ü—Ä–æ–∑–æ—Ä–∏–º–∏ –¥–ª—è Mouse Events

**–ö–æ–¥ (–¥–æ–¥–∞–Ω–æ):**
```typescript
sx={{
  // ... —ñ–Ω—à—ñ —Å—Ç–∏–ª—ñ
  pointerEvents: 'none', // –ö–†–ò–¢–ò–ß–ù–û: –Ω–µ –±–ª–æ–∫—É—î–º–æ mouse events
}}
```

## üìù –ó–º—ñ–Ω–µ–Ω—ñ –§–∞–π–ª–∏

- `src/components/worksheet/canvas/CanvasPage.tsx`:
  - Lines 643-660: –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ drag/drop handlers
  - Line 627: –î–æ–¥–∞–Ω–æ `pointerEvents: 'none'` –¥–æ drop indicator
  - Line 767: –î–æ–¥–∞–Ω–æ `pointerEvents: 'none'` –¥–æ drop indicator –ø—ñ—Å–ª—è –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞

## üß™ –©–æ –¢–µ—Å—Ç—É–≤–∞—Ç–∏

### –¢–µ—Å—Ç 1: –ü–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è –≤ –º–µ–∂–∞—Ö –æ–¥–Ω—ñ—î—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏
1. –°—Ç–≤–æ—Ä—ñ—Ç—å —Å—Ç–æ—Ä—ñ–Ω–∫—É –∑ 5+ –µ–ª–µ–º–µ–Ω—Ç–∞–º–∏
2. –ü–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å –µ–ª–µ–º–µ–Ω—Ç –∑ –ø–æ–∑–∏—Ü—ñ—ó 4 –Ω–∞ –ø–æ–∑–∏—Ü—ñ—é 2
3. **–û—á—ñ–∫—É—î—Ç—å—Å—è:** –ï–ª–µ–º–µ–Ω—Ç –ø–µ—Ä–µ–º—ñ—Å—Ç–∏—Ç—å—Å—è –∑ –ø–æ–∑–∏—Ü—ñ—ó 4 –Ω–∞ –ø–æ–∑–∏—Ü—ñ—é 2 ‚úÖ

### –¢–µ—Å—Ç 2: –ü–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è –º—ñ–∂ —Å—Ç–æ—Ä—ñ–Ω–∫–∞–º–∏
1. –°—Ç–≤–æ—Ä—ñ—Ç—å 2 —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –∑ –µ–ª–µ–º–µ–Ω—Ç–∞–º–∏
2. –ü–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å –µ–ª–µ–º–µ–Ω—Ç –∑—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ 1 –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É 2
3. **–û—á—ñ–∫—É—î—Ç—å—Å—è:** –ï–ª–µ–º–µ–Ω—Ç –≤–∏–¥–∞–ª–∏—Ç—å—Å—è –∑—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ 1 —ñ –¥–æ–¥–∞—Å—Ç—å—Å—è –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É 2 ‚úÖ

### –¢–µ—Å—Ç 3: Drop –Ω–∞ –≤—ñ–∑—É–∞–ª—å–Ω–∏–π —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä
1. –ü–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å –µ–ª–µ–º–µ–Ω—Ç –¥–æ –ø–æ—è–≤–∏ —Å–∏–Ω—å–æ—ó –ª—ñ–Ω—ñ—ó –º—ñ–∂ –µ–ª–µ–º–µ–Ω—Ç–∞–º–∏
2. –í—ñ–¥–ø—É—Å—Ç—ñ—Ç—å –º–∏—à–∫—É –ü–†–Ø–ú–û –Ω–∞ —Å–∏–Ω—ñ–π –ª—ñ–Ω—ñ—ó
3. **–û—á—ñ–∫—É—î—Ç—å—Å—è:** –ï–ª–µ–º–µ–Ω—Ç –≤–ø–∞–¥–µ –Ω–∞ –≤–∫–∞–∑–∞–Ω—É –ø–æ–∑–∏—Ü—ñ—é ‚úÖ

### –¢–µ—Å—Ç 4: Locked –µ–ª–µ–º–µ–Ω—Ç–∏
1. –ó–∞–±–ª–æ–∫—É–π—Ç–µ –µ–ª–µ–º–µ–Ω—Ç (locked)
2. –°–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ç—è–≥–Ω—É—Ç–∏ locked –µ–ª–µ–º–µ–Ω—Ç
3. **–û—á—ñ–∫—É—î—Ç—å—Å—è:** –ù–µ–º–æ–∂–ª–∏–≤–æ –ø–µ—Ä–µ—Ç—è–≥–Ω—É—Ç–∏ locked –µ–ª–µ–º–µ–Ω—Ç
4. –°–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ç—è–≥–Ω—É—Ç–∏ —ñ–Ω—à–∏–π –µ–ª–µ–º–µ–Ω—Ç –ù–ê locked –µ–ª–µ–º–µ–Ω—Ç
5. **–û—á—ñ–∫—É—î—Ç—å—Å—è:** Drop –≤—Å–µ –æ–¥–Ω–æ –ø—Ä–∞—Ü—é—î ‚úÖ

## üìä Console Logs

–ü—ñ–¥ —á–∞—Å —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤–∏ –ø–æ–≤–∏–Ω–Ω—ñ –±–∞—á–∏—Ç–∏ —Ü—ñ –ª–æ–≥–∏:

**During drag:**
```
üîç [handleElementDragOver] { pageId, index, isCrossPageDrag, draggedIndex, crossPageDrag }
‚úÖ [handleElementDragOver] Within-page drag, showing indicator at index: 3
```

**On drop:**
```
üì¶ [handleElementDrop] Drop event triggered { pageId, dropIndex, draggedIndex, crossPageDrag }
üîç [handleElementDrop] isCrossPageDrag: true/false
üîÑ [handleElementDrop] Attempting within-page reorder
‚úÖ [handleElementDrop] Calling onElementReorder: { from: 4, to: 3 }
```

**In parent component:**
```
üîÑ [handleElementReorder] Called with: { pageId, fromIndex, toIndex }
‚úÖ [handleElementReorder] Elements reordered successfully
```

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ Within-page reordering –ø—Ä–∞—Ü—é—î  
‚úÖ Cross-page moving –ø—Ä–∞—Ü—é—î  
‚úÖ Drop –Ω–∞ –≤—ñ–∑—É–∞–ª—å–Ω—ñ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä–∏ –ø—Ä–∞—Ü—é—î  
‚úÖ Locked –µ–ª–µ–º–µ–Ω—Ç–∏ –æ–±—Ä–æ–±–ª—è—é—Ç—å—Å—è –∫–æ—Ä–µ–∫—Ç–Ω–æ

## üìö –î–µ—Ç–∞–ª—å–Ω–∞ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

–î–ª—è –ø–æ–≤–Ω–æ—ó —Ç–µ—Ö–Ω—ñ—á–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –¥–∏–≤—ñ—Ç—å—Å—è:
- [DRAG_AND_DROP_FIX_COMPLETE.md](./DRAG_AND_DROP_FIX_COMPLETE.md) - –ü–æ–≤–Ω–∏–π –æ–ø–∏—Å –±–∞–≥—ñ–≤ —ñ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å
- [DRAG_AND_DROP_TESTING_GUIDE.md](./DRAG_AND_DROP_TESTING_GUIDE.md) - –î–µ—Ç–∞–ª—å–Ω–∏–π –≥–∞–π–¥ –∑ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

---

**–î–∞—Ç–∞ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:** 2025-10-07  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ FIXED