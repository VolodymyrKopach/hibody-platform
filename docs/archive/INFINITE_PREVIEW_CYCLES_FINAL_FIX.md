# –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª—É –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø—Ä–µ–≤—å—é —Å–ª–∞–π–¥—ñ–≤

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—ñ –∞–±–æ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó —Å–ª–∞–π–¥—ñ–≤ —É —Å–∏—Å—Ç–µ–º—ñ –≤–∏–Ω–∏–∫–∞–≤ –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–∏–π —Ü–∏–∫–ª –∑–∞–ø–∏—Ç—ñ–≤ –Ω–∞ –±–µ–∫–µ–Ω–¥ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø—Ä–µ–≤—å—é —Å–ª–∞–π–¥—ñ–≤. –§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ—Å—Ç—ñ–π–Ω–æ –≥–µ–Ω–µ—Ä—É–≤–∞–≤ –ø—Ä–µ–≤—å—é, –≤—ñ–¥–æ–±—Ä–∞–∂–∞–≤ —ó—Ö, –ø–æ—Ç—ñ–º —á–æ–º—É—Å—å –¥—É–º–∞–≤ —â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –∑–Ω–æ–≤—É.

## –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω—ñ –ø—Ä–∏—á–∏–Ω–∏

1. **–ó–∞–π–≤—ñ –≤–∏–∫–ª–∏–∫–∏ `updateCurrentLesson`** - —Ñ—É–Ω–∫—Ü—ñ—è –≤–∏–∫–ª–∏–∫–∞–ª–∞—Å—è –Ω–∞–≤—ñ—Ç—å –∫–æ–ª–∏ —É—Ä–æ–∫ –Ω–µ –∑–º—ñ–Ω—é–≤–∞–≤—Å—è
2. **–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ —Å—Ç—Ä–æ–≥—ñ —É–º–æ–≤–∏ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø—Ä–µ–≤—å—é** - –ø—Ä–µ–≤—å—é –≥–µ–Ω–µ—Ä—É–≤–∞–ª–∏—Å—è –∑–∞–Ω–∞–¥—Ç–æ —á–∞—Å—Ç–æ
3. **–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å throttling –º–µ—Ö–∞–Ω—ñ–∑–º—É** - –Ω–µ –±—É–ª–æ –æ–±–º–µ–∂–µ–Ω—å –Ω–∞ —á–∞—Å—Ç–æ—Ç—É –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó
4. **–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—ñ —Å–ª–∞–π–¥—ñ–≤** - —Å–ª–∞–π–¥–∏ –≤–≤–∞–∂–∞–ª–∏—Å—è –∑–º—ñ–Ω–µ–Ω–∏–º–∏ –Ω–∞–≤—ñ—Ç—å –∫–æ–ª–∏ –≤–æ–Ω–∏ –±—É–ª–∏ —ñ–¥–µ–Ω—Ç–∏—á–Ω–∏–º–∏

## –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

### 1. –î–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è
–î–æ–¥–∞–Ω–æ –ø–æ–≤–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –≤:
- `useSlideManagement` hook
- `PreviewSelector` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç  
- `updateCurrentLesson` —Ñ—É–Ω–∫—Ü—ñ—é
- `generateSlidePreview` —Ñ—É–Ω–∫—Ü—ñ—é

### 2. Throttling –º–µ—Ö–∞–Ω—ñ–∑–º
```typescript
const previewGenerationThrottleRef = useRef<Record<string, number>>({});
const PREVIEW_THROTTLE_DELAY = 5000; // 5 —Å–µ–∫—É–Ω–¥ –º—ñ–∂ —Å–ø—Ä–æ–±–∞–º–∏
```

### 3. –û–±–º–µ–∂–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Å–ø—Ä–æ–±
```typescript
const previewGenerationAttemptsRef = useRef<Record<string, number>>({});
const MAX_PREVIEW_ATTEMPTS = 3; // –ú–∞–∫—Å–∏–º—É–º 3 —Å–ø—Ä–æ–±–∏ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Å–ª–∞–π–¥—É
```

### 4. –°—Ç—Ä–æ–≥—ñ —É–º–æ–≤–∏ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø—Ä–µ–≤—å—é
```typescript
const isNewSlideWithoutPreview = !hasPreview && !wasProcessed;
const isRecentlyUpdatedSlide = slideUpdateTime > lastUpdateTime && 
                              slideUpdateTime > Date.now() - 10000 && // –ó–º–µ–Ω—à–µ–Ω–æ –¥–æ 10 —Å–µ–∫—É–Ω–¥
                              slideUpdateTime !== 0;

const shouldGenerate = isNewSlideWithoutPreview || isRecentlyUpdatedSlide;
```

### 5. –ì–ª–∏–±–æ–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—ñ —É—Ä–æ–∫—ñ–≤
```typescript
const lessonsAreIdentical = 
  lesson.title === prev.currentLesson.title &&
  lesson.description === prev.currentLesson.description &&
  lesson.subject === prev.currentLesson.subject &&
  lesson.ageGroup === prev.currentLesson.ageGroup &&
  lesson.duration === prev.currentLesson.duration &&
  lesson.slides?.length === prev.currentLesson.slides?.length &&
  lesson.slides?.every((newSlide, index) => {
    const oldSlide = prev.currentLesson?.slides[index];
    return oldSlide &&
           newSlide.id === oldSlide.id &&
           newSlide.title === oldSlide.title &&
           newSlide.content === oldSlide.content &&
           newSlide.htmlContent === oldSlide.htmlContent &&
           newSlide.type === oldSlide.type &&
           newSlide.status === oldSlide.status &&
           (newSlide.updatedAt?.getTime() || 0) === (oldSlide.updatedAt?.getTime() || 0);
  });
```

### 6. –ü–æ–∫—Ä–∞—â–µ–Ω–∞ –ª–æ–≥—ñ–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —É–º–æ–≤
–î–æ–¥–∞–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏:
- `!isCurrentlyGenerating` - –Ω–µ –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è –∑–∞—Ä–∞–∑
- `!isThrottled` - –Ω–µ throttled (–Ω–µ –±—É–ª–æ —Å–ø—Ä–æ–±–∏ –ø—Ä–æ—Ç—è–≥–æ–º 5 —Å–µ–∫—É–Ω–¥)
- `!tooManyAttempts` - –Ω–µ –ø–µ—Ä–µ–≤–∏—â–µ–Ω–æ –º–∞–∫—Å–∏–º—É–º —Å–ø—Ä–æ–± (3)
- –ë—ñ–ª—å—à —Å—Ç—Ä–æ–≥–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∞—Å—É –æ–Ω–æ–≤–ª–µ–Ω–Ω—è (10 —Å–µ–∫—É–Ω–¥ –∑–∞–º—ñ—Å—Ç—å 20)

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –°—Ü–µ–Ω–∞—Ä—ñ—ó –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è:
1. **–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ —Å–ª–∞–π–¥—É** - –ø—Ä–µ–≤—å—é –º–∞—î –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏—Å—è –æ–¥–∏–Ω —Ä–∞–∑
2. **–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Å–ª–∞–π–¥—É** - –ø—Ä–µ–≤—å—é –º–∞—î –æ–Ω–æ–≤–∏—Ç–∏—Å—è –æ–¥–∏–Ω —Ä–∞–∑
3. **–†–µ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—è —Å–ª–∞–π–¥—É** - –ø—Ä–µ–≤—å—é –º–∞—î –æ–Ω–æ–≤–∏—Ç–∏—Å—è –æ–¥–∏–Ω —Ä–∞–∑  
4. **–®–≤–∏–¥–∫—ñ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ –∑–º—ñ–Ω–∏** - –º–∞—î —Å–ø—Ä–∞—Ü—é–≤–∞—Ç–∏ throttling
5. **–ü–æ–≤—Ç–æ—Ä–Ω—ñ –Ω–µ–≤–¥–∞–ª—ñ —Å–ø—Ä–æ–±–∏** - –º–∞—î –∑—É–ø–∏–Ω–∏—Ç–∏—Å—è –ø—ñ—Å–ª—è 3 —Å–ø—Ä–æ–±

### –ö–æ–º–∞–Ω–¥–∏ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è:
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
npm run dev

# –í—ñ–¥–∫—Ä–∏—Ç–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞ —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–æ–≥–∏ –∑ –ø—Ä–µ—Ñ—ñ–∫—Å–∞–º–∏:
# üîÑ PREVIEW GENERATION EFFECT
# üéØ PREVIEW GENERATION  
# üîç PREVIEW GENERATION
# üöÄ PREVIEW GENERATION
# ‚è≠Ô∏è PREVIEW GENERATION
# üîÑ UPDATE CURRENT LESSON
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

- ‚úÖ –ó—É–ø–∏–Ω–µ–Ω–æ –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω—ñ —Ü–∏–∫–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø—Ä–µ–≤—å—é
- ‚úÖ –î–æ–¥–∞–Ω–æ –∫–æ–Ω—Ç—Ä–æ–ª—å —á–∞—Å—Ç–æ—Ç–∏ –∑–∞–ø–∏—Ç—ñ–≤ (throttling)
- ‚úÖ –û–±–º–µ–∂–µ–Ω–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ø—Ä–æ–±
- ‚úÖ –ü–æ–∫—Ä–∞—â–µ–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É —É–º–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó
- ‚úÖ –î–æ–¥–∞–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- ‚úÖ –ó–º–µ–Ω—à–µ–Ω–æ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ –±–µ–∫–µ–Ω–¥

## –õ–æ–≥–∏ –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É

–í—Å—ñ –ª–æ–≥–∏ –º–∞—é—Ç—å —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –ø—Ä–µ—Ñ—ñ–∫—Å–∏ –¥–ª—è –ª–µ–≥–∫–æ–≥–æ —Ñ—ñ–ª—å—Ç—Ä—É–≤–∞–Ω–Ω—è:
- `üîÑ PREVIEW GENERATION` - –æ—Å–Ω–æ–≤–Ω—ñ –ø–æ–¥—ñ—ó –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø—Ä–µ–≤—å—é
- `üîÑ UPDATE CURRENT LESSON` - –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ —É—Ä–æ–∫—É
- `üé® GENERATE SLIDE PREVIEW` - –¥–µ—Ç–∞–ª—ñ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–µ–≤—å—é
- `üéØ PREVIEW SELECTOR` - –ø–æ–¥—ñ—ó –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ –ø—Ä–µ–≤—å—é

## –°—Ç–∞—Ç—É—Å: ‚úÖ –í–ò–ü–†–ê–í–õ–ï–ù–û

–ù–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–∏–π —Ü–∏–∫–ª –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø—Ä–µ–≤—å—é —Å–ª–∞–π–¥—ñ–≤ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ. –°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä –ø—Ä–∞—Ü—é—î —Å—Ç–∞–±—ñ–ª—å–Ω–æ –∑ –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–æ—é –≥–µ–Ω–µ—Ä–∞—Ü—ñ—î—é –ø—Ä–µ–≤—å—é. 