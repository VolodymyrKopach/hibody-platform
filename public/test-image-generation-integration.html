<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∑–æ–±—Ä–∞–∂–µ–Ω—å –≤ —Å–ª–∞–π–¥–∏</title>
    <style>
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .code-block {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        button {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: transform 0.3s ease;
        }
        button:hover {
            transform: scale(1.05);
        }
        button:disabled {
            opacity: 0.6;
            transform: none;
            cursor: not-allowed;
        }
        .result {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
        .success { border-left: 4px solid #4caf50; }
        .error { border-left: 4px solid #f44336; }
        .warning { border-left: 4px solid #ff9800; }
        .image-preview {
            max-width: 100%;
            border-radius: 8px;
            margin: 10px 0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
    <h1>üé® –¢–µ—Å—Ç —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∑–æ–±—Ä–∞–∂–µ–Ω—å –≤ —Å–ª–∞–π–¥–∏</h1>
    
    <div class="test-section">
        <h2>üìã –ï—Ç–∞–ø 1: –¢–µ—Å—Ç –ø–∞—Ä—Å–∏–Ω–≥—É IMAGE_PROMPT –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤</h2>
        <p>–ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–∞—Ä—Å–∏—Ç—å—Å—è HTML –∑ IMAGE_PROMPT –∫–æ–º–µ–Ω—Ç–∞—Ä—è–º–∏:</p>
        
        <div class="code-block">
HTML –∑ –∫–æ–º–µ–Ω—Ç–∞—Ä—è–º–∏:
&lt;!-- IMAGE_PROMPT: "A colorful cartoon cat teaching math to children" WIDTH: 512 HEIGHT: 384 --&gt;
&lt;!-- IMAGE_PROMPT: "Simple geometric shapes for kids education" WIDTH: 640 HEIGHT: 480 --&gt;
        </div>
        
        <button onclick="testImagePromptParsing()">üîç –¢–µ—Å—Ç –ø–∞—Ä—Å–∏–Ω–≥—É</button>
        <div id="parsing-result" class="result" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h2>üéØ –ï—Ç–∞–ø 2: –¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è —á–µ—Ä–µ–∑ FLUX</h2>
        <p>–ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –ø—Ä–∞—Ü—é—î –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –æ–¥–Ω–æ–≥–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è:</p>
        
        <button onclick="testSingleImageGeneration()" id="single-image-btn">üì∏ –ì–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è</button>
        <div id="single-image-result" class="result" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h2>üöÄ –ï—Ç–∞–ø 3: –¢–µ—Å—Ç –ø–æ–≤–Ω–æ—ó —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó</h2>
        <p>–ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –≤—Å—é —Å–∏—Å—Ç–µ–º—É: –ø–∞—Ä—Å–∏–Ω–≥ ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è ‚Üí –∑–∞–º—ñ–Ω–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤:</p>
        
        <button onclick="testFullIntegration()" id="full-integration-btn">üé® –ü–æ–≤–Ω–∏–π —Ç–µ—Å—Ç</button>
        <div id="full-integration-result" class="result" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏</h2>
        <ul id="test-results">
            <li>‚è≥ –¢–µ—Å—Ç–∏ —â–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω—ñ</li>
        </ul>
    </div>

    <script>
        const results = [];
        
        function updateResults() {
            const resultsList = document.getElementById('test-results');
            resultsList.innerHTML = results.map(result => 
                `<li class="${result.status}">${result.message}</li>`
            ).join('');
        }
        
        function addResult(message, status = 'info') {
            results.push({ message, status, timestamp: new Date() });
            updateResults();
        }

        async function testImagePromptParsing() {
            const resultDiv = document.getElementById('parsing-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '‚è≥ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø–∞—Ä—Å–∏–Ω–≥—É...';
            
            try {
                const testHtml = `
                <div>
                    <!-- IMAGE_PROMPT: "A colorful cartoon cat teaching math to children" WIDTH: 512 HEIGHT: 384 -->
                    <h1>–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –¥–ª—è –¥—ñ—Ç–µ–π</h1>
                    <!-- IMAGE_PROMPT: "Simple geometric shapes for kids education" WIDTH: 640 HEIGHT: 480 -->
                    <p>–ö–æ–Ω—Ç–µ–Ω—Ç —Å–ª–∞–π–¥—É</p>
                </div>`;
                
                // –°–∏–º—É–ª—é—î–º–æ –ø–∞—Ä—Å–∏–Ω–≥ (–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—ñ —Ü–µ –±—É–¥–µ —á–µ—Ä–µ–∑ API)
                const imageCommentRegex = /<!--\s*IMAGE_PROMPT:\s*"([^"]+)"\s+WIDTH:\s*(\d+)\s+HEIGHT:\s*(\d+)\s*-->/gi;
                const matches = [...testHtml.matchAll(imageCommentRegex)];
                
                if (matches.length > 0) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            ‚úÖ –ó–Ω–∞–π–¥–µ–Ω–æ ${matches.length} –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤:
                            ${matches.map((match, i) => `
                                <br/><strong>–ö–æ–º–µ–Ω—Ç–∞—Ä ${i + 1}:</strong>
                                <br/>–ü—Ä–æ–º–ø—Ç: "${match[1]}"
                                <br/>–†–æ–∑–º—ñ—Ä–∏: ${match[2]}x${match[3]}
                            `).join('')}
                        </div>`;
                    addResult(`‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤: –∑–Ω–∞–π–¥–µ–Ω–æ ${matches.length} –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤`, 'success');
                } else {
                    resultDiv.innerHTML = '<div class="error">‚ùå –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω—ñ</div>';
                    addResult('‚ùå –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤: –ø—Ä–æ–≤–∞–ª–µ–Ω–æ', 'error');
                }
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}</div>`;
                addResult(`‚ùå –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤: –ø–æ–º–∏–ª–∫–∞ - ${error.message}`, 'error');
            }
        }

        async function testSingleImageGeneration() {
            const button = document.getElementById('single-image-btn');
            const resultDiv = document.getElementById('single-image-result');
            
            button.disabled = true;
            button.textContent = '‚è≥ –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è...';
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '‚è≥ –ì–µ–Ω–µ—Ä—É—î–º–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è —á–µ—Ä–µ–∑ FLUX API...';
            
            try {
                const response = await fetch('/api/images', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        prompt: "A colorful cartoon cat teaching mathematics to children, educational style, bright colors, friendly, safe for kids",
                        width: 512,
                        height: 384
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.success && data.image) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            ‚úÖ –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ!
                            <br/><strong>–ú–æ–¥–µ–ª—å:</strong> ${data.model}
                            <br/><strong>–†–æ–∑–º—ñ—Ä:</strong> ~${Math.round(data.image.length / 1024)}KB
                            <img src="data:image/webp;base64,${data.image}" 
                                 alt="${data.prompt}" 
                                 class="image-preview" 
                                 style="max-width: 300px;" />
                        </div>`;
                    addResult('‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è: —É—Å–ø—ñ—à–Ω–æ', 'success');
                } else {
                    resultDiv.innerHTML = `<div class="error">‚ùå –ü–æ–º–∏–ª–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó: ${data.error}</div>`;
                    addResult(`‚ùå –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è: ${data.error}`, 'error');
                }
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–ø–∏—Ç—É: ${error.message}</div>`;
                addResult(`‚ùå –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è: –ø–æ–º–∏–ª–∫–∞ –∑–∞–ø–∏—Ç—É - ${error.message}`, 'error');
            } finally {
                button.disabled = false;
                button.textContent = 'üì∏ –ì–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è';
            }
        }

        async function testFullIntegration() {
            const button = document.getElementById('full-integration-btn');
            const resultDiv = document.getElementById('full-integration-result');
            
            button.disabled = true;
            button.textContent = '‚è≥ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è...';
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '‚è≥ –ó–∞–ø—É—Å–∫–∞—î–º–æ –ø–æ–≤–Ω–∏–π —Ç–µ—Å—Ç —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó...';
            
            try {
                // –°–∏–º—É–ª—é—î–º–æ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—é —Å–ª–∞–π–¥—É –∑ Claude
                resultDiv.innerHTML += '<br/>üéØ –ì–µ–Ω–µ—Ä—É—î–º–æ —Å–ª–∞–π–¥ –∑ Claude...';
                
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: "–°—Ç–≤–æ—Ä–∏ —Å–ª–∞–π–¥ –ø—Ä–æ –∫–æ—Ç–∞ —è–∫–∏–π –≤—á–∏—Ç—å –º–∞—Ç–µ–º–∞—Ç–∏–∫—É –¥—ñ—Ç–µ–π –≤—ñ–∫–æ–º 6-8 —Ä–æ–∫—ñ–≤",
                        action: "generate_next_slide"
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            ‚úÖ –ü–æ–≤–Ω–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–∞!
                            <br/><strong>–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:</strong> ${data.message}
                            <br/><strong>–î—ñ—ó:</strong> ${data.actions?.length || 0}
                            ${data.lesson ? `<br/><strong>–°–ª–∞–π–¥—ñ–≤ —É —É—Ä–æ—Ü—ñ:</strong> ${data.lesson.slides?.length || 0}` : ''}
                        </div>`;
                    addResult('‚úÖ –ü–æ–≤–Ω–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è: —É—Å–ø—ñ—à–Ω–æ', 'success');
                } else {
                    resultDiv.innerHTML = `<div class="error">‚ùå –ü–æ–º–∏–ª–∫–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó: ${data.error}</div>`;
                    addResult(`‚ùå –ü–æ–≤–Ω–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è: ${data.error}`, 'error');
                }
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå –ü–æ–º–∏–ª–∫–∞ —Ç–µ—Å—Ç—É: ${error.message}</div>`;
                addResult(`‚ùå –ü–æ–≤–Ω–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è: –ø–æ–º–∏–ª–∫–∞ - ${error.message}`, 'error');
            } finally {
                button.disabled = false;
                button.textContent = 'üé® –ü–æ–≤–Ω–∏–π —Ç–µ—Å—Ç';
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–ø—É—Å–∫–∞—î–º–æ —Ç–µ—Å—Ç –ø–∞—Ä—Å–∏–Ω–≥—É –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        window.addEventListener('load', () => {
            addResult('üöÄ –¢–µ—Å—Ç–æ–≤–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞', 'info');
        });
    </script>
</body>
</html> 