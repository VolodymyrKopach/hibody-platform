# üéØ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è Claude Integration

## –ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω
‚úÖ **–£—Å–ø—ñ—à–Ω–æ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –Ω–æ–≤—É –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É!**

### –§–∞–π–ª–∏ —Å—Ç–≤–æ—Ä–µ–Ω—ñ:
- ‚úÖ `src/services/intent/ClaudeHaikuIntentService.ts` - Claude Haiku –¥–ª—è –¥–µ—Ç–µ–∫—Ü—ñ—ó —ñ–Ω—Ç–µ–Ω—Ç—ñ–≤
- ‚úÖ `src/services/content/ClaudeSonnetContentService.ts` - Claude Sonnet –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∫–æ–Ω—Ç–µ–Ω—Ç—É  
- ‚úÖ `src/services/chat/handlers/EnhancedCreateLessonHandler.ts` - –ü–æ–∫—Ä–∞—â–µ–Ω–∏–π –æ–±—Ä–æ–±–Ω–∏–∫ —É—Ä–æ–∫—ñ–≤
- ‚úÖ `src/services/chat/handlers/DataCollectionHandler.ts` - –ó–±—ñ—Ä –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—ñ—Ö –¥–∞–Ω–∏—Ö
- ‚úÖ –û–Ω–æ–≤–ª–µ–Ω–æ `ChatService.ts` —Ç–∞ —ñ–Ω—à—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏

### –†–µ–∂–∏–º–∏ —Ä–æ–±–æ—Ç–∏:

#### 1. üöÄ –¢—ñ–ª—å–∫–∏ Claude —Ä–µ–∂–∏–º (–æ–±–æ–≤'—è–∑–∫–æ–≤–∏–π)
```
‚úÖ Using Claude Haiku for enhanced intent detection
```

**–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è:**
```bash
curl -X POST http://localhost:3000/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "—Å—Ç–≤–æ—Ä–∏ —É—Ä–æ–∫ –ø—Ä–æ –¥–∏–Ω–æ–∑–∞–≤—Ä—ñ–≤ –¥–ª—è –¥–∏—Ç–∏–Ω–∏ 8 —Ä–æ–∫—ñ–≤"}'
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ Intent —Ä–æ–∑–ø—ñ–∑–Ω–∞–Ω–æ: CREATE_LESSON (confidence: 0.95) - —á–µ—Ä–µ–∑ Claude Haiku
- ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –≤–∏—Ç—è–≥–Ω—É—Ç–æ: topic="–¥–∏–Ω–æ–∑–∞–≤—Ä–∏", age="8 —Ä–æ–∫—ñ–≤" - —Å–µ–º–∞–Ω—Ç–∏—á–Ω–æ 
- ‚úÖ –ü–ª–∞–Ω –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ Claude Sonnet (–±–µ–∑ —à–∞–±–ª–æ–Ω—ñ–≤!)

#### 2. üö´ –ë–µ–∑ API –∫–ª—é—á–∞ (—Å–∏—Å—Ç–µ–º–∞ –Ω–µ –ø—Ä–∞—Ü—é—î)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```bash
‚ùå Claude API key is required for intent detection.

üìù How to fix:
1. Get your API key from: https://console.anthropic.com/
2. Add to .env.local file:
   CLAUDE_API_KEY=sk-ant-api03-your-key-here
3. Restart the development server

üö´ NO FALLBACK - Claude Haiku is required for intelligent intent detection.
```

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ –Ω–æ–≤–æ—ó –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏:**
- üéØ Claude Haiku —à–≤–∏–¥–∫–æ –≤–∏–∑–Ω–∞—á–∞—î —ñ–Ω—Ç–µ–Ω—Ç –∑ –≤–∏—Å–æ–∫–æ—é —Ç–æ—á–Ω—ñ—Å—Ç—é
- üß† –í–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö: –ø–µ—Ä–µ–≤—ñ—Ä—è—î —á–∏ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó
- üí¨ Smart questions: –≥–µ–Ω–µ—Ä—É—î –ø–∏—Ç–∞–Ω–Ω—è –¥–ª—è –∑–±–æ—Ä—É –¥–∞–Ω–∏—Ö
- üé® Claude Sonnet –≥–µ–Ω–µ—Ä—É—î —è–∫—ñ—Å–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç –±–µ–∑ —à–∞–±–ª–æ–Ω—ñ–≤

## üéÆ –ü—Ä–∏–∫–ª–∞–¥–∏ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –°—Ü–µ–Ω–∞—Ä—ñ–π 1: –ü–æ–≤–Ω—ñ –¥–∞–Ω—ñ
```bash
curl -X POST http://localhost:3000/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "—Å—Ç–≤–æ—Ä–∏ —É—Ä–æ–∫ –ø—Ä–æ –∫–æ—Å–º–æ—Å –¥–ª—è –¥—ñ—Ç–µ–π 7 —Ä–æ–∫—ñ–≤"}'
```

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "intent": "CREATE_LESSON",
  "confidence": 0.95,
  "isDataSufficient": true,
  "parameters": {
    "topic": "–∫–æ—Å–º–æ—Å",
    "age": "7 —Ä–æ–∫—ñ–≤"
  }
}
```

### –°—Ü–µ–Ω–∞—Ä—ñ–π 2: –ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—ñ –¥–∞–Ω—ñ
```bash
curl -X POST http://localhost:3000/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "—Ö–æ—á—É —É—Ä–æ–∫ –ø—Ä–æ —Ç–≤–∞—Ä–∏–Ω"}'
```

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–∑ Claude):**
```json
{
  "intent": "CREATE_LESSON",
  "confidence": 0.85,
  "isDataSufficient": false,
  "missingData": ["age"],
  "suggestedQuestion": "–î–ª—è —è–∫–æ–≥–æ –≤—ñ–∫—É –¥—ñ—Ç–µ–π —Å—Ç–≤–æ—Ä–∏—Ç–∏ —É—Ä–æ–∫ –ø—Ä–æ —Ç–≤–∞—Ä–∏–Ω?"
}
```

**–ü–æ—Ç–æ—á–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (fallback):**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—ñ–¥—Å—Ç–∞–≤–ª—è—î –≤—ñ–∫ 6 —Ä–æ–∫—ñ–≤
- –ì–µ–Ω–µ—Ä—É—î –ø–ª–∞–Ω –æ–¥—Ä–∞–∑—É

### –°—Ü–µ–Ω–∞—Ä—ñ–π 3: –ù–µ—è—Å–Ω–∏–π –∑–∞–ø–∏—Ç
```bash
curl -X POST http://localhost:3000/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "–º–æ–∂–Ω–∞ —â–æ—Å—å —Ü—ñ–∫–∞–≤–µ?"}'
```

**–ó Claude Haiku:**
- –í–∏–∑–Ω–∞—á–∏—Ç—å –Ω–µ–≤—ñ–¥–æ–º–∏–π —ñ–Ω—Ç–µ–Ω—Ç
- –ü–æ—Å—Ç–∞–≤–∏—Ç—å —É—Ç–æ—á–Ω—é–≤–∞–ª—å–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è

**Fallback:**
- –í—ñ–¥–ø—Ä–∞–≤–∏—Ç—å –¥–æ HelpHandler

## üîç –õ–æ–≥—É–≤–∞–Ω–Ω—è

### Console.log –≤ ChatService:
```
üéØ Processing message: "—Å—Ç–≤–æ—Ä–∏ —É—Ä–æ–∫ –ø—Ä–æ –¥–∏–Ω–æ–∑–∞–≤—Ä—ñ–≤ –¥–ª—è –¥–∏—Ç–∏–Ω–∏ 8 —Ä–æ–∫—ñ–≤"
üìã Conversation step: none
üéØ [INTENT] CREATE_LESSON (confidence: 0.95)
üìù [PARAMETERS] { topic: "–¥–∏–Ω–æ–∑–∞–≤—Ä–∏", age: "8 —Ä–æ–∫—ñ–≤" }
‚úÖ [DATA SUFFICIENT] true
üîß [HANDLER] EnhancedCreateLessonHandler
```

### Fallback —Ä–µ–∂–∏–º:
```
‚ùå Claude API key not found, using keyword-based fallback
üîß [HANDLER] CreateLessonHandler (fallback)
```

## üìä –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó

### ‚úÖ –ì–æ—Ç–æ–≤–æ:
- [x] ClaudeHaikuIntentService - –¥–µ—Ç–µ–∫—Ü—ñ—è —ñ–Ω—Ç–µ–Ω—Ç—ñ–≤
- [x] ClaudeSonnetContentService - –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –∫–æ–Ω—Ç–µ–Ω—Ç—É
- [x] EnhancedCreateLessonHandler - –ø–æ–∫—Ä–∞—â–µ–Ω–∏–π –æ–±—Ä–æ–±–Ω–∏–∫
- [x] DataCollectionHandler - –∑–±—ñ—Ä –¥–∞–Ω–∏—Ö
- [x] Enhanced interfaces - —Ä–æ–∑—à–∏—Ä–µ–Ω—ñ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏
- [x] Factory pattern - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –≤–∏–±—ñ—Ä —Å–µ—Ä–≤—ñ—Å—É
- [x] Fallback logic - —Ä–µ–∑–µ—Ä–≤–Ω–∞ –ª–æ–≥—ñ–∫–∞

### üéØ –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏:
- [ ] –î–æ–¥–∞—Ç–∏ Claude API –∫–ª—é—á –¥–ª—è –ø–æ–≤–Ω–æ–≥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
- [ ] –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤ –∑ Claude
- [ ] –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ–º–ø—Ç—ñ–≤
- [ ] A/B —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è —è–∫–æ—Å—Ç—ñ –∫–æ–Ω—Ç–µ–Ω—Ç—É
- [ ] –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

## üí° –ü–æ—Ç–µ–Ω—Ü—ñ–π–Ω—ñ –ø–æ–ª—ñ–ø—à–µ–Ω–Ω—è

1. **–ö–µ—à—É–≤–∞–Ω–Ω—è:** –ó–±–µ—Ä—ñ–≥–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ Claude –¥–ª—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ
2. **–ú—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ñ—Å—Ç—å:** –î–æ–¥–∞—Ç–∏ –∞–Ω–∞–ª—ñ–∑ –∑–æ–±—Ä–∞–∂–µ–Ω—å/–≥–æ–ª–æ—Å—É
3. **–ü–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–∞—Ü—ñ—è:** –ê–¥–∞–ø—Ç—É–≤–∞—Ç–∏ –ø—ñ–¥ —Å—Ç–∏–ª—å –Ω–∞–≤—á–∞–Ω–Ω—è –¥–∏—Ç–∏–Ω–∏
4. **–ê–Ω–∞–ª—ñ—Ç–∏–∫–∞:** –í—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ —É—Å–ø—ñ—à–Ω—ñ—Å—Ç—å —Ä—ñ–∑–Ω–∏—Ö –ø—ñ–¥—Ö–æ–¥—ñ–≤

## üöÄ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤ –±—Ä–∞—É–∑–µ—Ä—ñ

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ http://localhost:3000/chat
2. –ù–∞–ø–∏—à—ñ—Ç—å: "—Å—Ç–≤–æ—Ä–∏ —É—Ä–æ–∫ –ø—Ä–æ –¥–∏–Ω–æ–∑–∞–≤—Ä—ñ–≤ –¥–ª—è –¥–∏—Ç–∏–Ω–∏ 8 —Ä–æ–∫—ñ–≤"
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –¥–ª—è –ª–æ–≥—ñ–≤
4. –ü–æ–¥–∏–≤—ñ—Ç—å—Å—è –Ω–∞ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –ø–ª–∞–Ω

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–ù–æ–≤–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞!** 
- ‚úÖ –ü—Ä–∞—Ü—é—î –≤ fallback —Ä–µ–∂–∏–º—ñ –±–µ–∑ API –∫–ª—é—á–∞
- üöÄ –ì–æ—Ç–æ–≤–∞ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Claude API
- üîß –õ–µ–≥–∫–æ —Ä–æ–∑—à–∏—Ä—é–≤–∞–Ω–∞ —Ç–∞ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω–∞
- üìä –î–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –¥–ª—è debug'—É 