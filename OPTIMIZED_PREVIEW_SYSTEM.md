# –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–≤—å—é —É—Ä–æ–∫—ñ–≤

## üéØ –ö–ª—é—á–æ–≤–µ —Ä—ñ—à–µ–Ω–Ω—è

**–ó–±–µ—Ä—ñ–≥–∞—Ç–∏ –≤ Supabase Storage —Ç—ñ–ª—å–∫–∏ –≤–∏–±—Ä–∞–Ω–∏–π –ø—Ä–µ–≤—å—é —É—Ä–æ–∫—É, –∞ –Ω–µ –≤—Å—ñ thumbnail'–∏ —Å–ª–∞–π–¥—ñ–≤!**

## üîÑ –ù–æ–≤–∏–π –ø—Ä–æ—Ü–µ—Å –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è

### 1. **–°—Ç–≤–æ—Ä–µ–Ω–Ω—è/—Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Å–ª–∞–π–¥—ñ–≤**
```
–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —Å—Ç–≤–æ—Ä—é—î —Å–ª–∞–π–¥–∏ ‚Üí Thumbnail'–∏ –≥–µ–Ω–µ—Ä—É—é—Ç—å—Å—è –õ–û–ö–ê–õ–¨–ù–û
                        ‚Üì
LocalThumbnailStorage.memoryCache (–≤ –ø–∞–º'—è—Ç—ñ –±—Ä–∞—É–∑–µ—Ä–∞)
```

### 2. **–í–∏–±—ñ—Ä –ø—Ä–µ–≤—å—é –¥–ª—è —É—Ä–æ–∫—É**
```
SaveLessonDialog ‚Üí PreviewSelector ‚Üí –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∏–±–∏—Ä–∞—î —Å–ª–∞–π–¥
                                   ‚Üì
dialogData.selectedPreviewId = "slide_123"
dialogData.previewUrl = "data:image/png;base64,..."
```

### 3. **–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —É—Ä–æ–∫—É**
```
handleSaveLesson() ‚Üí –¢—ñ–ª—å–∫–∏ –≤–∏–±—Ä–∞–Ω–∏–π thumbnail –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è –≤ Storage
                   ‚Üì
localThumbnailStorage.uploadToStorage(selectedPreviewId, lessonId)
                   ‚Üì
lesson.thumbnail_url = "https://supabase.../lessons/lessonId/thumbnails/slide_123_timestamp.png"
```

## üìä –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è: –î–æ vs –ü—ñ—Å–ª—è

### ‚ùå **–ë—É–ª–æ (–Ω–µ–µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ):**
```typescript
// –ó–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞–ª–∏ –í–°–Ü thumbnail'–∏
const storageUrls = await localThumbnailStorage.uploadAllToStorage(lessonId, selectedSlideIds);
// –†–µ–∑—É–ª—å—Ç–∞—Ç: 5 —Å–ª–∞–π–¥—ñ–≤ = 5 —Ñ–∞–π–ª—ñ–≤ –≤ Storage (1-2 MB)

slides: selectedSlideIds.map(slideId => ({
  ...slide,
  thumbnailUrl: storageUrls[slideId] // –ö–æ–∂–µ–Ω —Å–ª–∞–π–¥ –º–∞–≤ —Å–≤—ñ–π URL
}))
```

### ‚úÖ **–°—Ç–∞–ª–æ (–æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ):**
```typescript
// –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –¢–Ü–õ–¨–ö–ò –≤–∏–±—Ä–∞–Ω–∏–π –ø—Ä–µ–≤—å—é
const lessonThumbnailUrl = await localThumbnailStorage.uploadToStorage(
  dialogData.selectedPreviewId, 
  lessonId
);
// –†–µ–∑—É–ª—å—Ç–∞—Ç: 5 —Å–ª–∞–π–¥—ñ–≤ = 1 —Ñ–∞–π–ª –≤ Storage (200-400 KB)

// –ü—Ä–µ–≤—å—é —É—Ä–æ–∫—É –Ω–∞ —Ä—ñ–≤–Ω—ñ lesson
thumbnailUrl: lessonThumbnailUrl,

// –°–ª–∞–π–¥–∏ –±–µ–∑ thumbnail'—ñ–≤
slides: selectedSlideIds.map(slideId => ({
  ...slide,
  thumbnailUrl: null // –°–ª–∞–π–¥–∏ –Ω–µ –º–∞—é—Ç—å —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∏—Ö –ø—Ä–µ–≤—å—é
}))
```

## üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤

### **SaveLessonDialog**
```tsx
<PreviewSelector
  slides={selectedSlides}
  selectedPreviewId={dialogData.selectedPreviewId}
  onPreviewSelect={(slideId, previewUrl) => {
    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤–∏–±—ñ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    setSaveDialogData(prev => ({
      ...prev,
      selectedPreviewId: slideId,
      previewUrl: previewUrl
    }));
  }}
/>
```

### **useSlideManagement.saveSelectedSlides**
```typescript
// 1. –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ç—ñ–ª—å–∫–∏ –≤–∏–±—Ä–∞–Ω–∏–π –ø—Ä–µ–≤—å—é
let lessonThumbnailUrl: string | null = null;

if (dialogData.selectedPreviewId && dialogData.previewUrl) {
  lessonThumbnailUrl = await localThumbnailStorage.uploadToStorage(
    dialogData.selectedPreviewId, 
    lessonId
  );
}

// 2. –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
const response = await fetch('/api/lessons', {
  method: 'POST',
  body: JSON.stringify({
    title: dialogData.title,
    subject: dialogData.subject,
    targetAge: dialogData.ageGroup,
    thumbnail_url: lessonThumbnailUrl, // ‚úÖ –¢—ñ–ª—å–∫–∏ –≤–∏–±—Ä–∞–Ω–∏–π –ø—Ä–µ–≤—å—é
    slides: selectedSlideIds.map(slideId => ({
      title: slide.title,
      htmlContent: slide.htmlContent,
      // thumbnailUrl –Ω–µ –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è –¥–ª—è —Å–ª–∞–π–¥—ñ–≤
    }))
  })
});
```

### **API Route /api/lessons**
```typescript
const lessonData: LessonInsert = {
  user_id: user.id,
  title: body.title,
  thumbnail_url: body.thumbnail_url, // ‚úÖ –ü—Ä–µ–≤—å—é —É—Ä–æ–∫—É
  // ...
};

// –°–ª–∞–π–¥–∏ —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è –±–µ–∑ thumbnail_url
await slideService.createSlide({
  lesson_id: lesson.id,
  title: slideData.title,
  html_content: slideData.htmlContent,
  // thumbnail_url: null - –Ω–µ –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è
});
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª—ñ–≤ –≤ Storage

### **–¢–µ–ø–µ—Ä:**
```
lesson-assets/
‚îî‚îÄ‚îÄ lessons/
    ‚îî‚îÄ‚îÄ lesson_1751234567890/
        ‚îî‚îÄ‚îÄ thumbnails/
            ‚îî‚îÄ‚îÄ slide_abc123_1751234567890.png  ‚Üê –¢—ñ–ª—å–∫–∏ –≤–∏–±—Ä–∞–Ω–∏–π –ø—Ä–µ–≤—å—é
```

### **–†–∞–Ω—ñ—à–µ –±—É–ª–æ:**
```
lesson-assets/
‚îî‚îÄ‚îÄ lessons/
    ‚îî‚îÄ‚îÄ lesson_1751234567890/
        ‚îî‚îÄ‚îÄ thumbnails/
            ‚îú‚îÄ‚îÄ slide_abc123_1751234567890.png
            ‚îú‚îÄ‚îÄ slide_def456_1751234567891.png
            ‚îú‚îÄ‚îÄ slide_ghi789_1751234567892.png
            ‚îú‚îÄ‚îÄ slide_jkl012_1751234567893.png
            ‚îî‚îÄ‚îÄ slide_mno345_1751234567894.png  ‚Üê 5 —Ñ–∞–π–ª—ñ–≤ –∑–∞–º—ñ—Å—Ç—å 1
```

## üíæ –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö

### **–¢–∞–±–ª–∏—Ü—è `lessons`:**
```sql
CREATE TABLE lessons (
  id UUID PRIMARY KEY,
  title TEXT NOT NULL,
  thumbnail_url TEXT, -- ‚úÖ URL –≤–∏–±—Ä–∞–Ω–æ–≥–æ –ø—Ä–µ–≤—å—é
  -- ...
);
```

### **–¢–∞–±–ª–∏—Ü—è `slides`:**
```sql
CREATE TABLE slides (
  id UUID PRIMARY KEY,
  lesson_id UUID REFERENCES lessons(id),
  title TEXT NOT NULL,
  html_content TEXT,
  -- thumbnail_url TEXT, -- ‚ùå –ü–æ–ª–µ —ñ—Å–Ω—É—î, –∞–ª–µ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è
  -- ...
);
```

## üöÄ –ü–µ—Ä–µ–≤–∞–≥–∏ –Ω–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏

### **1. –ï–∫–æ–Ω–æ–º—ñ—è Storage**
- **–ë—É–ª–æ:** 5 —Å–ª–∞–π–¥—ñ–≤ √ó 200KB = 1MB –Ω–∞ —É—Ä–æ–∫
- **–°—Ç–∞–ª–æ:** 1 –ø—Ä–µ–≤—å—é √ó 200KB = 200KB –Ω–∞ —É—Ä–æ–∫
- **–ï–∫–æ–Ω–æ–º—ñ—è:** 80% –º—ñ—Å—Ü—è –≤ Storage

### **2. –®–≤–∏–¥–∫—ñ—Å—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è**
- **–ë—É–ª–æ:** 5 API –≤–∏–∫–ª–∏–∫—ñ–≤ –¥–æ Storage
- **–°—Ç–∞–ª–æ:** 1 API –≤–∏–∫–ª–∏–∫ –¥–æ Storage
- **–®–≤–∏–¥–∫—ñ—Å—Ç—å:** –í 5 —Ä–∞–∑—ñ–≤ —à–≤–∏–¥—à–µ

### **3. –ü—Ä–æ—Å—Ç–æ—Ç–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è**
- **–ë—É–ª–æ:** –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è thumbnail'–∞–º–∏ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Å–ª–∞–π–¥—É
- **–°—Ç–∞–ª–æ:** –û–¥–∏–Ω –ø—Ä–µ–≤—å—é –Ω–∞ —É—Ä–æ–∫
- **–ó—Ä—É—á–Ω—ñ—Å—Ç—å:** –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —Å–∞–º –≤–∏–±–∏—Ä–∞—î –Ω–∞–π–∫—Ä–∞—â–∏–π –ø—Ä–µ–≤—å—é

### **4. –£–∑–≥–æ–¥–∂–µ–Ω—ñ—Å—Ç—å –∑ UX**
- –í MaterialsPage –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –æ–¥–∏–Ω –ø—Ä–µ–≤—å—é –Ω–∞ —É—Ä–æ–∫
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∏–±–∏—Ä–∞—î —è–∫–∏–π —Å–∞–º–µ —Å–ª–∞–π–¥ —Å—Ç–∞–Ω–µ –ø—Ä–µ–≤—å—é
- –õ–æ–≥—ñ—á–Ω–æ: —É—Ä–æ–∫ = –æ–¥–∏–Ω –ø—Ä–µ–≤—å—é

## üé® UX Flow

### **1. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–ª–∞–π–¥—ñ–≤:**
```
–ß–∞—Ç ‚Üí "–°—Ç–≤–æ—Ä–∏ —É—Ä–æ–∫ –ø—Ä–æ –∫–æ—Å–º–æ—Å"
  ‚Üì
AI –≥–µ–Ω–µ—Ä—É—î 3 —Å–ª–∞–π–¥–∏
  ‚Üì
Thumbnail'–∏ –≥–µ–Ω–µ—Ä—É—é—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –¥–ª—è –≤—Å—ñ—Ö —Å–ª–∞–π–¥—ñ–≤
  ‚Üì
–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏—Ç—å –ø—Ä–µ–≤—å—é –≤—Å—ñ—Ö —Å–ª–∞–π–¥—ñ–≤ –≤ –ø–∞–Ω–µ–ª—ñ
```

### **2. –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —É—Ä–æ–∫—É:**
```
–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á ‚Üí "–ó–±–µ—Ä–µ–≥—Ç–∏ —É—Ä–æ–∫"
  ‚Üì
SaveLessonDialog –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è
  ‚Üì
PreviewSelector –ø–æ–∫–∞–∑—É—î –≤—Å—ñ –ª–æ–∫–∞–ª—å–Ω—ñ –ø—Ä–µ–≤—å—é
  ‚Üì
–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Ç–∏—Å–∫–∞—î —Å—Ç—Ä—ñ–ª–æ—á–∫–∏ ‚Üê‚Üí —ñ –æ–±–∏—Ä–∞—î –Ω–∞–π–∫—Ä–∞—â–∏–π
  ‚Üì
"–ó–±–µ—Ä–µ–≥—Ç–∏" ‚Üí –¢—ñ–ª—å–∫–∏ –≤–∏–±—Ä–∞–Ω–∏–π –ø—Ä–µ–≤—å—é –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è –≤ Storage
```

### **3. –ü–µ—Ä–µ–≥–ª—è–¥ –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö —É—Ä–æ–∫—ñ–≤:**
```
MaterialsPage ‚Üí –ü–æ–∫–∞–∑—É—î —É—Ä–æ–∫–∏ –∑ —ó—Ö –ø—Ä–µ–≤—å—é
  ‚Üì
–ö–æ–∂–µ–Ω —É—Ä–æ–∫ –º–∞—î –æ–¥–∏–Ω –∫—Ä–∞—Å–∏–≤–∏–π thumbnail
  ‚Üì
Thumbnail'–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è —à–≤–∏–¥–∫–æ (—Ç—ñ–ª—å–∫–∏ 1 –Ω–∞ —É—Ä–æ–∫)
```

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ –ø—Ä–∞—Ü—é—î:**

1. **–°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–ª–∞–π–¥—ñ–≤:**
   - Thumbnail'–∏ –≥–µ–Ω–µ—Ä—É—é—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ ‚úÖ
   - PreviewSelector –ø–æ–∫–∞–∑—É—î –≤—Å—ñ –ø—Ä–µ–≤—å—é ‚úÖ

2. **–í–∏–±—ñ—Ä –ø—Ä–µ–≤—å—é:**
   - –ú–æ–∂–Ω–∞ –Ω–∞—Ç–∏—Å–∫–∞—Ç–∏ ‚Üê‚Üí –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É ‚úÖ
   - –í–∏–±—Ä–∞–Ω–∏–π –ø—Ä–µ–≤—å—é –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ dialogData ‚úÖ

3. **–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —É—Ä–æ–∫—É:**
   - –¢—ñ–ª—å–∫–∏ –≤–∏–±—Ä–∞–Ω–∏–π –ø—Ä–µ–≤—å—é –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è –≤ Storage ‚úÖ
   - lesson.thumbnail_url –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚úÖ

4. **–ü–µ—Ä–µ–≥–ª—è–¥ —É—Ä–æ–∫—ñ–≤:**
   - MaterialsPage –ø–æ–∫–∞–∑—É—î –ø—Ä–µ–≤—å—é —É—Ä–æ–∫—ñ–≤ ‚úÖ
   - Thumbnail'–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è —à–≤–∏–¥–∫–æ ‚úÖ

### **–õ–æ–≥–∏ –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è:**
```
‚òÅÔ∏è NEW SAVE: –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤–∏–±—Ä–∞–Ω–æ–≥–æ –ø—Ä–µ–≤—å—é –≤ Storage: slide_abc123
üìä NEW SAVE: –ü—Ä–µ–≤—å—é —É—Ä–æ–∫—É –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ: https://supabase.../lessons/.../slide_abc123_1751234567890.png
```

## üîß –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ

### **–§–∞–π–ª–∏ —â–æ –∑–º—ñ–Ω–∏–ª–∏—Å—è:**
1. `src/hooks/useSlideManagement.ts` - –æ–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥—ñ–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
2. `src/app/api/lessons/route.ts` - –≤–∂–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î `thumbnail_url`
3. `src/types/api.ts` - –≤–∂–µ –º–∞—î `thumbnail_url` –≤ `CreateLessonRequest`

### **–§–∞–π–ª–∏ —â–æ –ù–ï –∑–º—ñ–Ω–∏–ª–∏—Å—è:**
1. `PreviewSelector.tsx` - –ø—Ä–æ–¥–æ–≤–∂—É—î –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ —è–∫ —Ä–∞–Ω—ñ—à–µ
2. `SaveLessonDialog.tsx` - –ø—Ä–æ–¥–æ–≤–∂—É—î –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ —è–∫ —Ä–∞–Ω—ñ—à–µ  
3. `LocalThumbnailService.ts` - –º–µ—Ç–æ–¥ `uploadToStorage` –≤–∂–µ —ñ—Å–Ω—É–≤–∞–≤

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–ï–∫–æ–Ω–æ–º—ñ—è Storage:** 80% –º–µ–Ω—à–µ —Ñ–∞–π–ª—ñ–≤  
‚úÖ **–®–≤–∏–¥–∫—ñ—Å—Ç—å:** 5√ó —à–≤–∏–¥—à–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è  
‚úÖ **UX:** –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∫–æ–Ω—Ç—Ä–æ–ª—é—î –≤–∏–±—ñ—Ä –ø—Ä–µ–≤—å—é  
‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞:** –û–¥–∏–Ω –ø—Ä–µ–≤—å—é –Ω–∞ —É—Ä–æ–∫ –∑–∞–º—ñ—Å—Ç—å –±–∞–≥–∞—Ç—å–æ—Ö  

–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞ —è–∫ –∑ —Ç–µ—Ö–Ω—ñ—á–Ω–æ—ó, —Ç–∞–∫ —ñ –∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–æ—ó —Ç–æ—á–∫–∏ –∑–æ—Ä—É! üöÄ 