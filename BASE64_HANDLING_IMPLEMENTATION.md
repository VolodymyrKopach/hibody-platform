# Base64 Images Handling Implementation

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—ñ —Å–ª–∞–π–¥—ñ–≤ –∑ base64 –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è–º–∏ –≤–∏–Ω–∏–∫–∞–ª–∞ –ø–æ–º–∏–ª–∫–∞ "prompt is too long: 212906 tokens > 200000 maximum" —á–µ—Ä–µ–∑ –≤–µ–ª–∏–∫–∏–π —Ä–æ–∑–º—ñ—Ä HTML –∫–æ–¥—É.

## –†—ñ—à–µ–Ω–Ω—è

–†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —Å–∏—Å—Ç–µ–º—É –≤–∏—Ç—è–≥—É–≤–∞–Ω–Ω—è —Ç–∞ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è base64 –∑–æ–±—Ä–∞–∂–µ–Ω—å:

1. **–í–∏—Ç—è–≥—É–≤–∞–Ω–Ω—è** - base64 –¥–∞–Ω—ñ –∑–∞–º—ñ–Ω—é—é—Ç—å—Å—è –Ω–∞ placeholder'–∏
2. **–û–±—Ä–æ–±–∫–∞** - —Å—Ç–∏—Å–ª–∏–π HTML –Ω–∞–¥—Å–∏–ª–∞—î—Ç—å—Å—è –¥–æ Claude
3. **–í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è** - base64 –¥–∞–Ω—ñ –≤—Å—Ç–∞–≤–ª—è—é—Ç—å—Å—è –Ω–∞–∑–∞–¥ —É —Ä–µ–∑—É–ª—å—Ç–∞—Ç

## –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è

### 1. –ú–µ—Ç–æ–¥–∏ –≤ SimpleEditService

#### extractBase64Images()
```typescript
private extractBase64Images(html: string): { 
  cleanedHTML: string; 
  extractedImages: Array<{ placeholder: string; data: string }> 
}
```

**–©–æ —Ä–æ–±–∏—Ç—å:**
- –ó–Ω–∞—Ö–æ–¥–∏—Ç—å –≤—Å—ñ `src="data:image/..."` –∞—Ç—Ä–∏–±—É—Ç–∏
- –ó–Ω–∞—Ö–æ–¥–∏—Ç—å –≤—Å—ñ `url(data:image/...)` –≤ CSS
- –ó–∞–º—ñ–Ω—é—î –Ω–∞ placeholder'–∏: `[BASE64_IMAGE_0]`, `[BASE64_CSS_1]`
- –ó–±–µ—Ä—ñ–≥–∞—î –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ

#### restoreBase64Images()
```typescript
private restoreBase64Images(
  html: string, 
  extractedImages: Array<{ placeholder: string; data: string }>
): string
```

**–©–æ —Ä–æ–±–∏—Ç—å:**
- –®—É–∫–∞—î placeholder'–∏ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ –≤—ñ–¥ Claude
- –ó–∞–º—ñ–Ω—é—î —ó—Ö –Ω–∞ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—ñ base64 –¥–∞–Ω—ñ
- –í—ñ–¥–Ω–æ–≤–ª—é—î —è–∫ –≤ `src` –∞—Ç—Ä–∏–±—É—Ç–∞—Ö, —Ç–∞–∫ —ñ –≤ CSS `url()`

#### compressHTML()
```typescript
private compressHTML(html: string): string
```

**–©–æ —Ä–æ–±–∏—Ç—å:**
- –í–∏–¥–∞–ª—è—î HTML –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ (–æ–∫—Ä—ñ–º IMAGE_PROMPT)
- –°—Ç–∏—Å–∫–∞—î –ø—Ä–æ–±—ñ–ª–∏ —Ç–∞ –ø–µ—Ä–µ–Ω–æ—Å–∏ —Ä—è–¥–∫—ñ–≤
- –í–∏–¥–∞–ª—è—î –∑–∞–π–≤—ñ –ø—Ä–æ–±—ñ–ª–∏ –º—ñ–∂ —Ç–µ–≥–∞–º–∏

### 2. –ü—Ä–æ—Ü–µ—Å –æ–±—Ä–æ–±–∫–∏

1. **–í–∏—Ç—è–≥—É–≤–∞–Ω–Ω—è:**
   ```
   –û—Ä–∏–≥—ñ–Ω–∞–ª: 212,906 —Å–∏–º–≤–æ–ª—ñ–≤
   –û—á–∏—â–µ–Ω–∏–π: 15,234 —Å–∏–º–≤–æ–ª—ñ–≤
   –°—Ç–∏—Å–ª–∏–π: 12,890 —Å–∏–º–≤–æ–ª—ñ–≤
   ```

2. **–í—ñ–¥–ø—Ä–∞–≤–∫–∞ –¥–æ Claude:**
   - –ù–∞–¥—Å–∏–ª–∞—î—Ç—å—Å—è —Å—Ç–∏—Å–ª–∏–π HTML –±–µ–∑ base64
   - –î–æ–¥–∞—é—Ç—å—Å—è —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –ø—Ä–æ placeholder'–∏
   - Claude –æ—Ç—Ä–∏–º—É—î –∑—Ä–æ–∑—É–º—ñ–ª–∏–π, –∫–æ–º–ø–∞–∫—Ç–Ω–∏–π –∫–æ–¥

3. **–í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è:**
   - –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ñ–¥ Claude –æ–±—Ä–æ–±–ª—è—î—Ç—å—Å—è
   - Placeholder'–∏ –∑–∞–º—ñ–Ω—é—é—Ç—å—Å—è –Ω–∞ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—ñ base64
   - –ü–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –ø–æ–≤–Ω–∏–π HTML –∑ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è–º–∏

### 3. –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–ª—è Claude

–î–æ–¥–∞–Ω–æ –≤ –ø—Ä–æ–º–ø—Ç:
```
7. üîÑ PLACEHOLDER'–ò: –Ø–∫—â–æ –±–∞—á–∏—à [BASE64_IMAGE_X] –∞–±–æ [BASE64_CSS_X] - —Ü–µ —Ç–∏–º—á–∞—Å–æ–≤—ñ placeholder'–∏, –ù–ï –≤–∏–¥–∞–ª—è–π —ó—Ö

**–†–û–ë–û–¢–ê –ó –ó–û–ë–†–ê–ñ–ï–ù–ù–Ø–ú–ò:**
- ‚ö†Ô∏è PLACEHOLDER'–ò: –Ø–∫—â–æ –±–∞—á–∏—à src="[BASE64_IMAGE_X]" - —Ü–µ —Ç–∏–º—á–∞—Å–æ–≤—ñ placeholder'–∏, –∑–±–µ—Ä—ñ–≥–∞–π —ó—Ö —è–∫ —î
```

## –ü—Ä–∏–∫–ª–∞–¥ —Ä–æ–±–æ—Ç–∏

### –î–æ –æ–±—Ä–æ–±–∫–∏:
```html
<img src="data:image/webp;base64,UklGRrQJAABXRUJQVlA4IKgJAABwLQCdASqAAIAAPm0wlEckIyIhITEsOIANiWdu4XcNMVF+..." />
```

### –ü—ñ–¥ —á–∞—Å –æ–±—Ä–æ–±–∫–∏:
```html
<img src="[BASE64_IMAGE_0]" />
```

### –ü—ñ—Å–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è:
```html
<img src="data:image/webp;base64,UklGRrQJAABXRUJQVlA4IKgJAABwLQCdASqAAIAAPm0wlEckIyIhITEsOIANiWdu4XcNMVF+..." />
```

## –õ–æ–≥—É–≤–∞–Ω–Ω—è

–°–∏—Å—Ç–µ–º–∞ –ª–æ–≥—É—î –ø—Ä–æ—Ü–µ—Å:
```
üìè Original: 212906, Cleaned: 15234, Compressed: 12890
üñºÔ∏è Extracted 3 base64 images
üîß Simple slide editing with Claude...
‚úÖ Simple slide edit completed, length: 198450
```

## –ü–µ—Ä–µ–≤–∞–≥–∏

1. **–†–æ–∑–≤'—è–∑—É—î –ø—Ä–æ–±–ª–µ–º—É token limit** - HTML —Å—Ç–∞—î –≤ 10-15 —Ä–∞–∑—ñ–≤ –º–µ–Ω—à–∏–π
2. **–ó–±–µ—Ä—ñ–≥–∞—î –≤—Å—ñ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è** - –Ω—ñ—á–æ–≥–æ –Ω–µ –≤—Ç—Ä–∞—á–∞—î—Ç—å—Å—è
3. **–ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å –¥–ª—è Claude** - AI –æ—Ç—Ä–∏–º—É—î —á–∏—Å—Ç–∏–π, –∑—Ä–æ–∑—É–º—ñ–ª–∏–π –∫–æ–¥
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ—Å—Ç—å** - –ø—Ä–∞—Ü—é—î –±–µ–∑ –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å

## –û–±–º–µ–∂–µ–Ω–Ω—è

1. **Regex —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å** - –ø–æ—Ç—Ä–µ–±—É—î —Ç–æ—á–Ω–∏—Ö —Ä–µ–≥—É–ª—è—Ä–Ω–∏—Ö –≤–∏—Ä–∞–∑—ñ–≤
2. **–ü–æ—Ä—è–¥–æ–∫ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è** - –≤–∞–∂–ª–∏–≤–æ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—É –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å
3. **CSS –ø—ñ–¥—Ç—Ä–∏–º–∫–∞** - –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ–±—Ä–æ–±–ª—è—Ç–∏ —è–∫ HTML, —Ç–∞–∫ —ñ CSS

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

–î–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è:
1. –°—Ç–≤–æ—Ä–∏—Ç–∏ —Å–ª–∞–π–¥ –∑ –≤–µ–ª–∏–∫–∏–º–∏ base64 –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è–º–∏
2. –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ ("–∑–∞–º—ñ–Ω–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫")
3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —â–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è
4. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä–æ–∑–º—ñ—Ä –ø—Ä–æ–º–ø—Ç—É –≤ –ª–æ–≥–∞—Ö

## –ú–∞–π–±—É—Ç–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è

1. **–ö–µ—à—É–≤–∞–Ω–Ω—è** - –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –≤–∏—Ç—è–≥–Ω—É—Ç—ñ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
2. **–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è** - —Å—Ç–∏—Å–∫–∞—Ç–∏ base64 –¥–∞–Ω—ñ
3. **–í–∞–ª—ñ–¥–∞—Ü—ñ—è** - –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ —Ü—ñ–ª—ñ—Å–Ω—ñ—Å—Ç—å –ø—ñ—Å–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è
4. **–ú–µ—Ç—Ä–∏–∫–∏** - –∑–±–∏—Ä–∞—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —Å—Ç–∏—Å–∫–∞–Ω–Ω—è 