// Age validation and group determination for adaptive content generation

export enum AgeGroup {
  TODDLERS = 'toddlers',      // 3-4 —Ä–æ–∫–∏
  PRESCHOOL = 'preschool',    // 5-6 —Ä–æ–∫—ñ–≤
  EARLY_SCHOOL = 'early',     // 7-8 —Ä–æ–∫—ñ–≤
  MIDDLE_SCHOOL = 'middle',   // 9-10 —Ä–æ–∫—ñ–≤
}

export interface AgeGroupConfig {
  name: string;
  description: string;
  minAge: number;
  maxAge: number;
  characteristics: string[];
  interactiveElements: string[];
  attentionSpan: number; // minutes
  preferredStyles: string[];
}

export const AGE_GROUP_CONFIGS: Record<AgeGroup, AgeGroupConfig> = {
  [AgeGroup.TODDLERS]: {
    name: 'üê£ –ú–∞–ª—é–∫–∏',
    description: '–î—É–∂–µ –ø—Ä–æ—Å—Ç—ñ –≤–∑–∞—î–º–æ–¥—ñ—ó, –≤–µ–ª–∏–∫—ñ –∫–Ω–æ–ø–∫–∏, —è—Å–∫—Ä–∞–≤—ñ –∫–æ–ª—å–æ—Ä–∏',
    minAge: 3,
    maxAge: 4,
    characteristics: [
      '–ö–æ—Ä–æ—Ç–∫–∏–π –ø–µ—Ä—ñ–æ–¥ —É–≤–∞–≥–∏ (3-5 —Ö–≤–∏–ª–∏–Ω)',
      '–õ—é–±–ª—è—Ç—å –≤–µ–ª–∏–∫—ñ —è—Å–∫—Ä–∞–≤—ñ –µ–ª–µ–º–µ–Ω—Ç–∏',
      '–ü–æ—Ç—Ä–µ–±—É—é—Ç—å –ø—Ä–æ—Å—Ç–∏—Ö –¥—ñ–π (–∫–ª—ñ–∫, —Ç–æ—Ä–∫–∞–Ω–Ω—è)',
      '–†–µ–∞–≥—É—é—Ç—å –Ω–∞ –∑–≤—É–∫–∏ —Ç–∞ –∞–Ω—ñ–º–∞—Ü—ñ—ó',
      '–ù–∞–≤—á–∞—é—Ç—å—Å—è —á–µ—Ä–µ–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è'
    ],
    interactiveElements: [
      '–í–µ–ª–∏–∫—ñ –∫–Ω–æ–ø–∫–∏ –∑ –∞–Ω—ñ–º–∞—Ü—ñ—î—é',
      '–ü—Ä–æ—Å—Ç–∏–π drag & drop',
      '–ó–≤—É–∫–æ–≤—ñ –µ—Ñ–µ–∫—Ç–∏ –ø—Ä–∏ –∫–ª—ñ–∫—É',
      '–Ø—Å–∫—Ä–∞–≤—ñ —Å–ø–∞–ª–∞—Ö–∏ —Ç–∞ –∞–Ω—ñ–º–∞—Ü—ñ—ó',
      '–í–µ–ª–∏–∫—ñ –µ–º–æ–¥–∂—ñ —Ç–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∏',
      '–ü—Ä–æ—Å—Ç—ñ hover –µ—Ñ–µ–∫—Ç–∏'
    ],
    attentionSpan: 5,
    preferredStyles: [
      '–î—É–∂–µ –≤–µ–ª–∏–∫—ñ —à—Ä–∏—Ñ—Ç–∏ (24px+)',
      '–Ø—Å–∫—Ä–∞–≤—ñ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ñ –∫–æ–ª—å–æ—Ä–∏',
      '–ë–∞–≥–∞—Ç–æ –±—ñ–ª–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—Ä—É',
      '–ü—Ä–æ—Å—Ç—ñ —Ñ–æ—Ä–º–∏ —Ç–∞ –∫–æ–Ω—Ç—É—Ä–∏',
      '–í–µ–ª–∏–∫—ñ —Ç–∞–∫—Ç–∏–ª—å–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏'
    ]
  },
  
  [AgeGroup.PRESCHOOL]: {
    name: 'üé® –î–æ—à–∫—ñ–ª—å–Ω—è—Ç–∞',
    description: '–Ü–≥—Ä–æ–≤—ñ –µ–ª–µ–º–µ–Ω—Ç–∏, –ø–µ—Ä—Å–æ–Ω–∞–∂—ñ, –ø—Ä–æ—Å—Ç—ñ –∑–∞–≤–¥–∞–Ω–Ω—è',
    minAge: 5,
    maxAge: 6,
    characteristics: [
      '–ü–µ—Ä—ñ–æ–¥ —É–≤–∞–≥–∏ 5-10 —Ö–≤–∏–ª–∏–Ω',
      '–õ—é–±–ª—è—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂—ñ–≤ —Ç–∞ —ñ—Å—Ç–æ—Ä—ñ—ó',
      '–ú–æ–∂—É—Ç—å –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –ø—Ä–æ—Å—Ç—ñ –∑–∞–≤–¥–∞–Ω–Ω—è',
      '–¶—ñ–∫–∞–≤–ª—è—Ç—å—Å—è –∫–æ–ª—å–æ—Ä–∞–º–∏ —Ç–∞ —Ñ–æ—Ä–º–∞–º–∏',
      '–ù–∞–≤—á–∞—é—Ç—å—Å—è —á–µ—Ä–µ–∑ –≥—Ä—É'
    ],
    interactiveElements: [
      '–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ –ø–µ—Ä—Å–æ–Ω–∞–∂—ñ',
      '–ú—ñ—Ç—Ç—ñ-—ñ–≥—Ä–∏ –∑ –∑–∞–≤–¥–∞–Ω–Ω—è–º–∏',
      '–ü—Ä–æ—Å—Ç—ñ –∫–≤—ñ–∑–∏ –∑ –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏',
      '–ü–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤',
      '–ê–Ω—ñ–º–æ–≤–∞–Ω—ñ –Ω–∞–≥–æ—Ä–æ–¥–∏',
      '–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ —ñ—Å—Ç–æ—Ä—ñ—ó',
      '–ü—Ä–æ—Å—Ç–∏–π –ø—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ –±–∞–ª—ñ–≤'
    ],
    attentionSpan: 8,
    preferredStyles: [
      '–í–µ–ª–∏–∫—ñ —à—Ä–∏—Ñ—Ç–∏ (20px+)',
      '–Ø—Å–∫—Ä–∞–≤—ñ –≤–µ—Å–µ–ª—ñ –∫–æ–ª—å–æ—Ä–∏',
      '–ó–∞–∫—Ä—É–≥–ª–µ–Ω—ñ –∫—É—Ç–∏',
      '–î–∏—Ç—è—á—ñ —ñ–ª—é—Å—Ç—Ä–∞—Ü—ñ—ó',
      '–ü–ª–∞–≤–Ω—ñ –∞–Ω—ñ–º–∞—Ü—ñ—ó'
    ]
  },
  
  [AgeGroup.EARLY_SCHOOL]: {
    name: 'üìö –ú–æ–ª–æ–¥—à—ñ —à–∫–æ–ª—è—Ä—ñ',
    description: '–ù–∞–≤—á–∞–ª—å–Ω—ñ —ñ–≥—Ä–∏, –ø—Ä–æ—Å—Ç–∏–π —Ç–µ–∫—Å—Ç, –±–∞–∑–æ–≤–∞ —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å',
    minAge: 7,
    maxAge: 8,
    characteristics: [
      '–ü–µ—Ä—ñ–æ–¥ —É–≤–∞–≥–∏ 10-15 —Ö–≤–∏–ª–∏–Ω',
      '–í–º—ñ—é—Ç—å —á–∏—Ç–∞—Ç–∏ –ø—Ä–æ—Å—Ç—ñ —Å–ª–æ–≤–∞',
      '–ú–æ–∂—É—Ç—å –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ –¥—ñ—ó',
      '–¶—ñ–∫–∞–≤–ª—è—Ç—å—Å—è –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è–º–∏',
      '–†–æ–∑—É–º—ñ—é—Ç—å –ø—Ä–æ—Å—Ç—ñ –ø—Ä–∞–≤–∏–ª–∞'
    ],
    interactiveElements: [
      '–û—Å–≤—ñ—Ç–Ω—ñ –º—ñ–Ω—ñ-—ñ–≥—Ä–∏',
      '–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ –≤–ø—Ä–∞–≤–∏',
      '–°–∏—Å—Ç–µ–º–∞ –±–∞–ª—ñ–≤ —Ç–∞ —Ä—ñ–≤–Ω—ñ–≤',
      '–ü—Ä–æ–≥—Ä–µ—Å-–±–∞—Ä–∏',
      '–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ —Ç–µ—Å—Ç–∏',
      'Drag&drop –∑ –ª–æ–≥—ñ–∫–æ—é',
      '–ó–±—ñ—Ä –ø—Ä–µ–¥–º–µ—Ç—ñ–≤',
      '–ü—Ä–æ—Å—Ç—ñ –ø–∞–∑–ª–∏'
    ],
    attentionSpan: 12,
    preferredStyles: [
      '–°–µ—Ä–µ–¥–Ω—ñ —à—Ä–∏—Ñ—Ç–∏ (18px+)',
      '–ó–±–∞–ª–∞–Ω—Å–æ–≤–∞–Ω—ñ –∫–æ–ª—å–æ—Ä–∏',
      '–°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏–π –º–∞–∫–µ—Ç',
      '–ß—ñ—Ç–∫—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó',
      '–í—ñ–∑—É–∞–ª—å–Ω–∏–π —Ñ—ñ–¥–±–µ–∫'
    ]
  },
  
  [AgeGroup.MIDDLE_SCHOOL]: {
    name: 'üéØ –°—Ç–∞—Ä—à—ñ —à–∫–æ–ª—è—Ä—ñ',
    description: '–°–∫–ª–∞–¥–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è, —Ç–µ–∫—Å—Ç–∏, —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏',
    minAge: 9,
    maxAge: 10,
    characteristics: [
      '–ü–µ—Ä—ñ–æ–¥ —É–≤–∞–≥–∏ 15-20 —Ö–≤–∏–ª–∏–Ω',
      '–î–æ–±—Ä–µ —á–∏—Ç–∞—é—Ç—å —Ç–∞ —Ä–æ–∑—É–º—ñ—é—Ç—å',
      '–ú–æ–∂—É—Ç—å –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ —Å–∫–ª–∞–¥–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è',
      '–¶—ñ–∫–∞–≤–ª—è—Ç—å—Å—è –¥–µ—Ç–∞–ª—è–º–∏',
      '–†–æ–∑—É–º—ñ—é—Ç—å —Å–∫–ª–∞–¥–Ω—ñ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—ó'
    ],
    interactiveElements: [
      '–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ —Å–∏–º—É–ª—è—Ü—ñ—ó',
      '–°–∫–ª–∞–¥–Ω—ñ —ñ–≥—Ä–∏ –∑ –ø—Ä–∞–≤–∏–ª–∞–º–∏',
      '–î–µ—Ç–∞–ª—å–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –¥–æ—Å—è–≥–Ω–µ–Ω—å',
      '–ú—É–ª—å—Ç–∏—Å—Ç–∞–¥—ñ–π–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è',
      '–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ –¥—ñ–∞–≥—Ä–∞–º–∏',
      '–í—ñ—Ä—Ç—É–∞–ª—å–Ω—ñ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏',
      '–ö–≤–µ—Å—Ç–∏ –∑ —Å—é–∂–µ—Ç–æ–º',
      '–¢–≤–æ—Ä—á—ñ –∑–∞–≤–¥–∞–Ω–Ω—è'
    ],
    attentionSpan: 18,
    preferredStyles: [
      '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ —à—Ä–∏—Ñ—Ç–∏ (16px+)',
      '–ü—Ä–æ—Ñ–µ—Å—ñ–π–Ω—ñ –∫–æ–ª—å–æ—Ä–∏',
      '–î–µ—Ç–∞–ª—å–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç',
      '–Ü–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏',
      '–°–∫–ª–∞–¥–Ω–∞ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—è'
    ]
  }
};

export function determineAgeGroup(age: number): AgeGroup {
  if (age >= 3 && age <= 4) return AgeGroup.TODDLERS;
  if (age >= 5 && age <= 6) return AgeGroup.PRESCHOOL;
  if (age >= 7 && age <= 8) return AgeGroup.EARLY_SCHOOL;
  if (age >= 9 && age <= 10) return AgeGroup.MIDDLE_SCHOOL;
  
  // Default fallback
  if (age < 3) return AgeGroup.TODDLERS;
  return AgeGroup.MIDDLE_SCHOOL;
}

export function extractAgeFromText(text: string): number | null {
  // –®—É–∫–∞—î–º–æ –≤—ñ–∫ —É —Ç–µ–∫—Å—Ç—ñ
  const agePatterns = [
    /(\d+)\s*(?:—Ä–æ–∫—ñ–≤?|—Ä—ñ–∫|year?s?|old)/i,
    /–¥–ª—è\s*–¥—ñ—Ç–µ–π\s*(\d+)/i,
    /–¥—ñ—Ç–∏\s*(\d+)/i,
    /age[:\s]*(\d+)/i,
    /–≤—ñ–∫[:\s]*(\d+)/i,
    /(\d+)\s*—Ä\./i
  ];
  
  for (const pattern of agePatterns) {
    const match = text.match(pattern);
    if (match) {
      const age = parseInt(match[1]);
      if (age >= 3 && age <= 10) {
        return age;
      }
    }
  }
  
  return null;
}

export function validateAge(age: number): { valid: boolean; message?: string } {
  if (age < 3) {
    return {
      valid: false,
      message: '–°–∏—Å—Ç–µ–º–∞ —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω–∞ –Ω–∞ –¥—ñ—Ç–µ–π –≤—ñ–¥ 3 —Ä–æ–∫—ñ–≤. –î–ª—è –º–æ–ª–æ–¥—à–∏—Ö –¥—ñ—Ç–µ–π –ø–æ—Ç—Ä—ñ–±–µ–Ω –æ—Å–æ–±–ª–∏–≤–∏–π –ø—ñ–¥—Ö—ñ–¥.'
    };
  }
  
  if (age > 10) {
    return {
      valid: false,
      message: '–°–∏—Å—Ç–µ–º–∞ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∞ –¥–ª—è –¥—ñ—Ç–µ–π –¥–æ 10 —Ä–æ–∫—ñ–≤. –î–ª—è —Å—Ç–∞—Ä—à–∏—Ö –¥—ñ—Ç–µ–π —Ä–µ–∫–æ–º–µ–Ω–¥—É—î–º–æ —ñ–Ω—à—ñ –º–µ—Ç–æ–¥–∏ –Ω–∞–≤—á–∞–Ω–Ω—è.'
    };
  }
  
  return { valid: true };
}

export function getAgeGroupConfig(age: number): AgeGroupConfig {
  const group = determineAgeGroup(age);
  return AGE_GROUP_CONFIGS[group];
}

export function generateAgePrompt(age: number): string {
  const config = getAgeGroupConfig(age);
  
  return `
**–í–Ü–ö–û–í–ê –ì–†–£–ü–ê:** ${config.name} (${age} ${age === 1 ? '—Ä—ñ–∫' : age < 5 ? '—Ä–æ–∫–∏' : '—Ä–æ–∫—ñ–≤'})

**–•–ê–†–ê–ö–¢–ï–†–ò–°–¢–ò–ö–ò –í–Ü–ö–£:**
${config.characteristics.map(char => `‚Ä¢ ${char}`).join('\n')}

**–û–ë–û–í'–Ø–ó–ö–û–í–Ü –Ü–ù–¢–ï–†–ê–ö–¢–ò–í–ù–Ü –ï–õ–ï–ú–ï–ù–¢–ò:**
${config.interactiveElements.map(elem => `‚Ä¢ ${elem}`).join('\n')}

**–°–¢–ò–õ–Ü–°–¢–ò–ß–ù–Ü –í–ò–ú–û–ì–ò:**
${config.preferredStyles.map(style => `‚Ä¢ ${style}`).join('\n')}

**–¢–†–ò–í–ê–õ–Ü–°–¢–¨ –£–í–ê–ì–ò:** ${config.attentionSpan} —Ö–≤–∏–ª–∏–Ω –º–∞–∫—Å–∏–º—É–º

**–ê–î–ê–ü–¢–ê–¶–Ü–Ø –ö–û–ù–¢–ï–ù–¢–£:**
- –†–æ–∑–¥—ñ–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–∞ —Å–µ–≥–º–µ–Ω—Ç–∏ –ø–æ ${Math.ceil(config.attentionSpan / 3)} —Ö–≤–∏–ª–∏–Ω–∏
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π ${config.name.toLowerCase()} –º–æ–≤—É —Ç–∞ –ø—Ä–∏–∫–ª–∞–¥–∏
- –ü–µ—Ä—ñ–æ–¥–∏—á–Ω–æ –¥–æ–¥–∞–≤–∞–π —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –∫–æ–∂–Ω—ñ 2-3 —Ö–≤–∏–ª–∏–Ω–∏
`;
} 