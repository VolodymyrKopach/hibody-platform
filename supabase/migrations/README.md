# Database Migrations

–ú—ñ–≥—Ä–∞—Ü—ñ—ó –æ—Ä–≥–∞–Ω—ñ–∑–æ–≤–∞–Ω—ñ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö –¥–ª—è –∑—Ä—É—á–Ω–æ—Å—Ç—ñ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ç–∞ –∑–∞–ø—É—Å–∫—É.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
migrations/
‚îú‚îÄ‚îÄ 01_initial_setup/      # –ë–∞–∑–æ–≤–∞ —Å—Ö–µ–º–∞ –ë–î (–∑–∞–≤–∂–¥–∏ –ø–æ—Ç—Ä—ñ–±–Ω–∞)
‚îú‚îÄ‚îÄ 02_storage/            # Storage buckets –¥–ª—è –∑–æ–±—Ä–∞–∂–µ–Ω—å
‚îú‚îÄ‚îÄ 03_payments/           # –ü–ª–∞—Ç–µ–∂—ñ —Ç–∞ –ø—ñ–¥–ø–∏—Å–∫–∏
‚îú‚îÄ‚îÄ 04_generation_limits/  # –õ—ñ–º—ñ—Ç–∏ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∫–æ–Ω—Ç–µ–Ω—Ç—É
‚îú‚îÄ‚îÄ 05_admin_panel/        # –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å —Ç–∞ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∞
‚îú‚îÄ‚îÄ 06_token_tracking/     # –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤ AI
‚îú‚îÄ‚îÄ 07_features/           # –û–∫—Ä–µ–º—ñ —Ñ—ñ—á—ñ (lesson plans, worksheets)
‚îî‚îÄ‚îÄ 08_rls_fixes/          # –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è RLS –ø–æ–ª—ñ—Ç–∏–∫
```

## üöÄ –Ø–∫ –∑–∞–ø—É—Å–∫–∞—Ç–∏

### –ú–µ—Ç–æ–¥ 1: –ß–µ—Ä–µ–∑ helper —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ) üéØ

```bash
# –í—Å—ñ –º—ñ–≥—Ä–∞—Ü—ñ—ó –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É
./scripts/run-migrations.sh all

# –¢—ñ–ª—å–∫–∏ –æ–¥–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è
./scripts/run-migrations.sh 05_admin_panel

# –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ–π
./scripts/run-migrations.sh list
```

### –ú–µ—Ç–æ–¥ 2: –ß–µ—Ä–µ–∑ Node.js —Å–∫—Ä–∏–ø—Ç

```bash
# –í—Å—ñ –º—ñ–≥—Ä–∞—Ü—ñ—ó
node scripts/run-migrations.js all

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è
node scripts/run-migrations.js 06_token_tracking

# –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π
node scripts/run-migrations.js list
```

‚ö†Ô∏è **–í–∞–∂–ª–∏–≤–æ**: Node.js –≤–µ—Ä—Å—ñ—è –º–∞—î –æ–±–º–µ–∂–µ–Ω–Ω—è. –î–ª—è production –∫—Ä–∞—â–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ bash —Å–∫—Ä–∏–ø—Ç –∞–±–æ Dashboard.

### –ú–µ—Ç–æ–¥ 3: –í—Ä—É—á–Ω—É —á–µ—Ä–µ–∑ Supabase Dashboard

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ Dashboard ‚Üí SQL Editor
2. –°–∫–æ–ø—ñ—é–π—Ç–µ –≤–º—ñ—Å—Ç SQL —Ñ–∞–π–ª—É
3. –í–∏–∫–æ–Ω–∞–π—Ç–µ
4. –ü–æ–≤—Ç–æ—Ä—ñ—Ç—å –¥–ª—è –≤—Å—ñ—Ö —Ñ–∞–π–ª—ñ–≤ —É –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó

### –ú–µ—Ç–æ–¥ 4: –ß–µ—Ä–µ–∑ psql (—è–∫—â–æ —î DATABASE_URL)

```bash
# –ï–∫—Å–ø–æ—Ä—Ç—É–π—Ç–µ DATABASE_URL
export DATABASE_URL="postgresql://..."

# –û–¥–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è
cd supabase/migrations/05_admin_panel
for file in *.sql; do
  psql $DATABASE_URL -f "$file"
done
```

## üìã –ü–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫—É (–¥–ª—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç—É)

1. **01_initial_setup** - –æ–±–æ–≤'—è–∑–∫–æ–≤–æ –ø–µ—Ä—à–∏–º
2. **02_storage** - —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
3. **03_payments** - —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –º–æ–Ω–µ—Ç–∏–∑–∞—Ü—ñ—è
4. **04_generation_limits** - —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –ª—ñ–º—ñ—Ç–∏
5. **05_admin_panel** - –¥–ª—è –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ
6. **06_token_tracking** - –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –≤–∏—Ç—Ä–∞—Ç AI
7. **07_features** - –¥–æ–¥–∞—Ç–∫–æ–≤—ñ —Ñ—ñ—á—ñ
8. **08_rls_fixes** - —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

## ‚ö†Ô∏è –í–∞–∂–ª–∏–≤–æ

- –ó–∞–≤–∂–¥–∏ —Ä–æ–±—ñ—Ç—å backup –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –º—ñ–≥—Ä–∞—Ü—ñ–π
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ —â–æ –º—ñ–≥—Ä–∞—Ü—ñ—ó –Ω–µ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—É—é—Ç—å
- –ù–µ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ `08_rls_fixes` –Ω–∞ production –±–µ–∑ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

